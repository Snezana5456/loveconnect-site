
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LoveConnect</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(to bottom, #ffd1dc, #f0f8ff);
      color: #333;
    }
    .container {
      max-width: 400px;
      margin: 50px auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    h2 {
      text-align: center;
      color: #ff5e86;
    }
    input, select, textarea, button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #ff5e86;
      color: white;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #e04b6a;
    }
    #profile-section {
      margin-top: 20px;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üíñ LoveConnect</h2>
    <input type="email" id="email" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞">
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
    <input type="text" id="full_name" placeholder="–ò–º—è">
    <input type="date" id="birth_date" placeholder="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è">
    <select id="gender">
      <option value="">–ü–æ–ª</option>
      <option value="male">–ú—É–∂—Å–∫–æ–π</option>
      <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
      <option value="other">–î—Ä—É–≥–æ–µ</option>
    </select>
    <textarea id="bio" placeholder="–û —Å–µ–±–µ..."></textarea>
    <button id="btnSignUp">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <button id="btnSignIn">–í–æ–π—Ç–∏</button>
    <button id="btnSignOut" style="display: none;">–í—ã–π—Ç–∏</button>

    <div id="profile-section">
      <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
      <p><strong>–ò–º—è:</strong> <span id="p_name"></span></p>
      <p><strong>Email:</strong> <span id="p_email"></span></p>
      <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> <span id="p_birth"></span></p>
      <p><strong>–ü–æ–ª:</strong> <span id="p_gender"></span></p>
      <p><strong>–û —Å–µ–±–µ:</strong><br><span id="p_bio"></span></p>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabase = createClient(
      'https://nokggxwhycdvjrrjkugej.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5va2dneHdoeWNkdmpyamt1Z2VqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4OTM4NTMsImV4cCI6MjA2OTQ2OTg1M30.h3FBLy-vFilgVcKKS_zXixBjRmYYSLFk94fIVQi_MwQ'
    )

    const emailInput = document.getElementById('email')
    const passwordInput = document.getElementById('password')
    const fullNameInput = document.getElementById('full_name')
    const birthDateInput = document.getElementById('birth_date')
    const genderInput = document.getElementById('gender')
    const bioInput = document.getElementById('bio')
    const signUpBtn = document.getElementById('btnSignUp')
    const signInBtn = document.getElementById('btnSignIn')
    const signOutBtn = document.getElementById('btnSignOut')
    const profileSection = document.getElementById('profile-section')

    signUpBtn.addEventListener('click', async () => {
      const { user, error: signUpError } = await supabase.auth.signUp({
        email: emailInput.value,
        password: passwordInput.value,
      })
      if (signUpError) return alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + signUpError.message)

      const { error: insertError } = await supabase.from('profiles').insert([{
        id: user.id,
        full_name: fullNameInput.value,
        birth_date: birthDateInput.value,
        gender: genderInput.value,
        bio: bioInput.value,
      }])
      if (insertError) alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ' + insertError.message)
      else {
        alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!')
        showProfile(user.id, user.email)
      }
    })

    signInBtn.addEventListener('click', async () => {
      const { data, error } = await supabase.auth.signInWithPassword({
        email: emailInput.value,
        password: passwordInput.value,
      })
      if (error) return alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message)
      signOutBtn.style.display = 'inline'
      showProfile(data.user.id, data.user.email)
    })

    signOutBtn.addEventListener('click', async () => {
      await supabase.auth.signOut()
      signOutBtn.style.display = 'none'
      profileSection.style.display = 'none'
      alert('–í—ã –≤—ã—à–ª–∏.')
    })

    async function showProfile(userId, email) {
      const { data, error } = await supabase.from('profiles').select('*').eq('id', userId).single()
      if (error) return alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è: ' + error.message)
      document.getElementById('p_name').textContent = data.full_name || ''
      document.getElementById('p_email').textContent = email
      document.getElementById('p_birth').textContent = data.birth_date || ''
      document.getElementById('p_gender').textContent = data.gender || ''
      document.getElementById('p_bio').textContent = data.bio || ''
      profileSection.style.display = 'block'
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–æ—à—ë–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    const checkUser = async () => {
      const { data: { user } } = await supabase.auth.getUser()
      if (user) {
        signOutBtn.style.display = 'inline'
        showProfile(user.id, user.email)
      }
    }
    checkUser()
  </script>
</body>
</html>
